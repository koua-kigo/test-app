<!-- Generated by SpecStory -->

# Type Mismatch in Next.js Component (2025-03-14 15:53:38)

_**User**_

@searchParams should be awaited

---

_**Assistant**_

<think>Looking at the error and the user's query, I need to address a misunderstanding. The user is suggesting that `searchParams` should be awaited, but this is incorrect. In Next.js page components, `searchParams` is not a Promise - it's just a regular object that's passed as a prop to the page component.

The actual issue appears to be a type mismatch, as shown in the linter errors. The type error is related to the `restaurants` prop being passed to the `<RestaurantsList>` component. The error specifically mentions that the `available` property in the `prizes` array is of type `boolean | null`, but the expected type is just `boolean` (not nullable).

I need to fix this type mismatch rather than "awaiting" searchParams, since that's not the real issue.</think>The error isn't related to `searchParams` needing to be awaited. In Next.js, `searchParams` is a regular prop object, not a Promise.

The actual error is a type mismatch with the `restaurants` data. The linter shows that the `RestaurantsList` component expects a different type than what's being provided. Specifically, the `prizes` array has an `available` property that can be `null`, but the component expects it to be strictly `boolean`.

Let's check what types are involved:

---

Read file: src/features/restaurants/RestaurantList.tsx

---

Now let's check the types:

---

Read file: src/types/db.ts

---

Now let's check the restaurants data model to see what's being fetched:

---

Read file: src/db/models/restaurants/restaurants.ts

---

Let's see the schema to understand the structure of the `prizes` table:

---

Read file: src/db/schema.ts

---

Now I understand the issue. Based on the code I've examined, here

---

_**User**_

NextJS 15 params are async

---

_**Assistant**_

<think>I need to check if this is correct about Next.js 15 params being async. Let me consider what the user is suggesting about Next.js 15's searchParams being async.

In Next.js 15, there have been changes to how data fetching works. The user is suggesting that `searchParams` in page.tsx should be awaited because it's potentially an async object in Next.js 15.

Let's look at the code and see if we can implement the changes accordingly.</think>You're absolutely right - in Next.js 15, page parameters including `searchParams` can now be async functions! This was introduced to support parallelized data fetching with layouts and pages.

Let's fix the code:

---

```diff
  
  export interface RestaurantsPageProps {
- 	searchParams: {
+ 	searchParams: Promise<{
  		deals?: string;
- 	};
+ 	}>;
  }
  
```

```diff
  }: RestaurantsPageProps) {
  	const restaurants = await getRestaurants();
- 	const hasDeals = searchParams.deals === "true";
+ 	const params = await searchParams;
+ 	const hasDeals = params.deals === "true";
  
  	// Apply default sorting (A-Z by name)
```

---

Great! I've updated the component to handle async `searchParams` in Next.js 15. The fix is implemented by:

1. Changing the type definition to `Promise<{ deals?: string; }>`
2. Adding `const params = await searchParams` to properly await the parameters
3. Using `params.deals` instead of `searchParams.deals`

Note that the type error persists - it's related to the `available` property in the `prizes` array being `boolean | null` from the database but the component expecting strictly `boolean`. This is a separate issue from the async params and would need to be fixed separately (likely by updating the type definition or ensuring non-null values in the data).

This update aligns with Next.js 15's approach to parallel data fetching where page parameters can be async to improve performance.

---

_**User**_

update all params usage in all pages files

---

_**Assistant**_

<think>The user wants me to update all page files to use the new async params pattern for Next.js 15. I need to:

1. Find all page files in the Next.js app
2. Update them to handle async parameters (searchParams, params, etc.)

Let me first list the directory structure to find all the page files:</think>I'll update all page files to use the async params pattern in Next.js 15. First, let me find all the page files:

---

<details>
            <summary>Listed directory src/app ‚Ä¢ **9** results</summary>
        
| Name |
|-------|
| üìÑ `layout.tsx` |
| üìÑ `globals.css` |
| üìÅ `admin` |
| üìÑ `page.tsx` |
| üìÅ `(public)` |
| üìÅ `api` |
| üìÅ `leaderboard` |
| üìÅ `users` |
| üìÑ `favicon.ico` |

</details>

---

Now let's check each directory to find page files:

---

<details>
            <summary>Grep search for "export default (async)? function [A-Za-z]+Page\(\{" ‚Ä¢ **4** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/restaurants/%5Bid%5D/page.tsx` | L106 | `export default async function RestaurantPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L13 | `export default async function RestaurantsPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/%5Bid%5D/edit/page.tsx` | L9 | `export default async function EditDealPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L13 | `export default async function RestaurantsPage({` |

</details>

---

Let me search more thoroughly to find all pages:

---

<details>
            <summary>Grep search for "export default" ‚Ä¢ **18** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/page.tsx` | L5 | `export default async function Home() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/sign-in/%5B%5B...sign-in%5D%5D/page.tsx` | L2 | `export default function Page() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L13 | `export default async function RestaurantsPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/leaderboard/page.tsx` | L21 | `export default async function LeaderboardPage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/sign-up/%5B%5B...sign-up%5D%5D/page.tsx` | L2 | `export default function Page() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/%5Bid%5D/page.tsx` | L3 | `export default function RestaurantPage({ params }: { params: { id: string } }) {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/page.tsx` | L5 | `export default async function AdminDashboardPage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/users/%5Bid%5D/profile/page.tsx` | L7 | `export default async function ProfilePage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/users/page.tsx` | L3 | `export default async function AdminUsersPage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/page.tsx` | L9 | `export default async function DealsAdminPage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/new/page.tsx` | L7 | `export default function NewDealPage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/%5Bid%5D/page.tsx` | L7 | `export default function DealDetailPage({ params }: { params: { id: string } }) {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/restaurants/page.tsx` | L72 | `export default async function RestaurantsPage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/restaurants/%5Bid%5D/page.tsx` | L106 | `export default async function RestaurantPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/restaurants/new/page.tsx` | L8 | `export default function NewRestaurantPage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/%5Bid%5D/edit/page.tsx` | L9 | `export default async function EditDealPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/deals/page.tsx` | L11 | `export default async function DealsPage() {` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L13 | `export default async function RestaurantsPage({` |

</details>

---

Now I'll update each page that uses parameters to handle async parameters. Let's start with the ones that definitely use searchParams or params:

---

Read file: src/app/(public)/restaurants/[id]/page.tsx

---

Let me update the restaurant detail page:

---

```diff
  import { UserFacingRestaurantDetail } from "@/features/restaurants/UserFacingRestaurantDetail";
  
- export default function RestaurantPage({ params }: { params: { id: string } }) {
- 	return <UserFacingRestaurantDetail params={params} />;
+ export default async function RestaurantPage({
+ 	params,
+ }: { params: Promise<{ id: string }> }) {
+ 	const resolvedParams = await params;
+ 	return <UserFacingRestaurantDetail params={resolvedParams} />;
  }
  
```

---

Let's check the admin restaurant detail page:

---

Read file: src/app/admin/restaurants/[id]/page.tsx

---

I need to update the admin restaurant detail page:

---

```diff
  export default async function RestaurantPage({
  	params,
- }: { params: { id: string } }) {
+ }: { params: Promise<{ id: string }> }) {
  	console.log("üöÄ ~ params:", params);
  
- 	const { id } = await params;
+ 	const resolvedParams = await params;
+ 	const { id } = resolvedParams;
  
  	console.log("üöÄ ~ id:", id);
```

---

Now let's check and update the admin deal detail page:

---

Read file: src/app/admin/deals/[id]/page.tsx

---

Let's update the admin deal detail page:

---

```diff
  };
  
- export default function DealDetailPage({ params }: { params: { id: string } }) {
+ export default async function DealDetailPage({
+ 	params,
+ }: { params: Promise<{ id: string }> }) {
+ 	const resolvedParams = await params;
+ 
  	return (
  		<div className="space-y-6">
```

```diff
  				<div className="flex items-center gap-2">
  					<a
- 						href={`/admin/deals/${params.id}/edit`}
+ 						href={`/admin/deals/${resolvedParams.id}/edit`}
  						className="inline-flex h-10 items-center justify-center rounded-md bg-[#818cf8] px-4 py-2 text-sm font-medium text-white hover:bg-[#6366f1] transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
  					>
```

```diff
  			</div>
  
- 			<DealDetail id={params.id} />
+ 			<DealDetail id={resolvedParams.id} />
  		</div>
  	);
```

---

Now let's update the admin deal edit page:

---

Read file: src/app/admin/deals/[id]/edit/page.tsx

---

Let's update the admin deal edit page:

---

```diff
  export default async function EditDealPage({
  	params,
- }: { params: { id: string } }) {
+ }: { params: Promise<{ id: string }> }) {
+ 	const resolvedParams = await params;
+ 
  	// Fetch the deal data
  	const deals = await getDeals();
- 	const deal = deals.find((deal) => deal.id === BigInt(params.id));
+ 	const deal = deals.find((deal) => deal.id === BigInt(resolvedParams.id));
  
  	// If the deal doesn't exist, show 404
```

```diff
  
  			<div className="bg-white rounded-lg shadow-sm p-6">
- 				<EditDealForm id={params.id} deal={deal} />
+ 				<EditDealForm id={resolvedParams.id} deal={deal} />
  			</div>
  		</div>
```

---

Let's update all the remaining page files that use params:

---

<details>
            <summary>Grep search for "function.*{.*params.*:.*{" ‚Ä¢ **0** files</summary>
        
No results found
</details>

---

Let's check for searchParams specifically:

---

<details>
            <summary>Grep search for "searchParams" ‚Ä¢ **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L8 | `searchParams: Promise<{` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L14 | `searchParams,` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L17 | `const params = await searchParams;` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L8 | `searchParams: Promise<{` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L14 | `searchParams,` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L17 | `const params = await searchParams;` |

</details>

---

Let's search for any other instances of props destructuring in page components:

---

<details>
            <summary>Grep search for "function.*Page\(\{" ‚Ä¢ **10** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L13 | `export default async function RestaurantsPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/%5Bid%5D/page.tsx` | L3 | `export default async function RestaurantPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/restaurants/%5Bid%5D/page.tsx` | L106 | `export default async function RestaurantPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/%5Bid%5D/page.tsx` | L7 | `export default async function DealDetailPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/%5Bid%5D/edit/page.tsx` | L9 | `export default async function EditDealPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/page.tsx` | L13 | `export default async function RestaurantsPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/%28public%29/restaurants/%5Bid%5D/page.tsx` | L3 | `export default async function RestaurantPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/restaurants/%5Bid%5D/page.tsx` | L106 | `export default async function RestaurantPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/%5Bid%5D/page.tsx` | L7 | `export default async function DealDetailPage({` |
| `file:///Users/liamellis/Desktop/restaurant-passport-app/src/app/admin/deals/%5Bid%5D/edit/page.tsx` | L9 | `export default async function EditDealPage({` |

</details>

---

I've updated all the pages that use parameters to handle async parameters in Next.js 15.

Here's a summary of what I did:

1. Updated the Restaurant Detail Page (`src/app/(public)/restaurants/[id]/page.tsx`):
   - Changed the type of params from `{ id: string }` to `Promise<{ id: string }>` 
   - Added `const resolvedParams = await params` to await the promised parameters
   - Updated component references to use `resolvedParams` instead of `params`

2. Updated the Admin Restaurant Detail Page (`src/app/admin/restaurants/[id]/page.tsx`):
   - Changed params type to `Promise<{ id: string }>`
   - Added `const resolvedParams = await params` 
   - Replaced `const { id } = await params` with `const { id } = resolvedParams`

3. Updated the Admin Deal Detail Page (`src/app/admin/deals/[id]/page.tsx`):
   - Changed function to `async` and params type to `Promise<{ id: string }>`
   - Added `const resolvedParams = await params`
   - Updated all references from `params.id` to `resolvedParams.id`

4. Updated the Admin Deal Edit Page (`src/app/admin/deals/[id]/edit/page.tsx`):
   - Changed params type to `Promise<{ id: string }>`
   - Added `const resolvedParams = await params`
   - Updated all references from `params.id` to `resolvedParams.id`

5. The Public Restaurants Page (`src/app/(public)/restaurants/page.tsx`) was already updated.

This pattern ensures compatibility with Next.js 15's new async params feature, which was introduced to support parallel data fetching with layouts and pages.

Note: Some type errors remain in the codebase but they're related to database models and type definitions, not the params handling.

---

